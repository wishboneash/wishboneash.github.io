<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Custom Messenger UI</title>
    <script type="text/javascript" charset="utf-8">
        (function (g, e, n, es, ys) {
          g['_genesysJs'] = e;
          g[e] = g[e] || function () {
            (g[e].q = g[e].q || []).push(arguments)
          };
          g[e].t = 1 * new Date();
          g[e].c = es;
          ys = document.createElement('script'); ys.async = 1; ys.src = n; ys.charset = 'utf-8'; document.head.appendChild(ys);
        })(window, 'Genesys', 'https://apps.mypurecloud.de/genesys-bootstrap/genesys.min.js', {
          environment: 'prod-euc1',
          deploymentId: '74c21148-3dd7-4d64-ba92-2a250fc7aa94',
          debug: true 
        });
      </script>

<script type="text/javascript">

Genesys("subscribe", "MessagingService.started", function({data}){
  console.log(data);
});    

Genesys("subscribe", "MessagingService.error", function({data}){
    console.log(data);
});


// Wait until the MessagingService plugin is ready
Genesys("subscribe", "MessagingService.ready", function () {
    console.log("MessagingService is ready.");

    // Start conversation
    document.getElementById('startChat').addEventListener('click', function () {
        Genesys("command", "MessagingService.startConversation", {}, function () {
            console.log("Conversation started.");
        }, function (err) {
            console.error("Start conversation failed:", err);
        });
    });

    // Clear conversation
    document.getElementById('clearChat').addEventListener('click', function () {
        Genesys("command", "MessagingService.clearConversation", {}, function () {
            console.log("Conversation cleared.");
            document.getElementById('chatWindow').innerHTML = '';
        }, function (err) {
            console.error("Clear conversation failed:", err);
        });
    });
});

// Listen for incoming messages
Genesys("subscribe", "MessagingService.messageReceived", function (event) {

    console.log("Message received:", event.data.message.text);
    const message = event.data.message.text;
    const chatWindow = document.getElementById('chatWindow');
    const msgElem = document.createElement('div');
    msgElem.textContent = `Agent: ${message}`;
    chatWindow.appendChild(msgElem);
});

// Send message
function sendMessage() {
    const message = document.getElementById('messageInput').value;
    if (!message.trim()) return;

    Genesys("command", "MessagingService.sendMessage", { message: message }, function () {
        const chatWindow = document.getElementById('chatWindow');
        const msgElem = document.createElement('div');
        msgElem.textContent = `You: ${message}`;
        chatWindow.appendChild(msgElem);
        console.log("Send message success");

        document.getElementById('messageInput').value = '';
    }, function (err) {
        console.error("Send message failed:", err);
        console.log("Send message failed");
    });
}
</script>
</head>
<body>
<div id="customChatUI">
<button id="startChat">Start Chat</button>
<button id="clearChat">Clear Conversation</button>

<div id="chatWindow" style="border:1px solid #ccc; padding:10px; margin:10px 0; height:200px; overflow-y:auto;">
    <!-- Messages will appear here -->
</div>

<input type="text" id="messageInput" placeholder="Type your message..." />
<button onclick="sendMessage()">Send</button>
</div>
</body>
</html>